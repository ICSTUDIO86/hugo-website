{{/* 简化的性能优化头部 */}}

{{/* DNS 预解析 */}}
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">

{{/* 预连接关键域名 */}}
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

{{/* PWA 支持 */}}
<link rel="manifest" href="{{ "manifest.json" | relURL }}">
<meta name="theme-color" content="#667eea">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

{{/* 关键资源预加载 */}}
{{ if .Site.Params.logo }}
<link rel="preload" href="{{ .Site.Params.logo | relURL }}" as="image">
{{ end }}

{{/* 页面特定优化 */}}
{{ if eq .Type "sight-reading-tool" }}
<link rel="preload" href="{{ "js/trial-limiter.js" | relURL }}" as="script">
<link rel="preload" href="{{ "js/cloudbase-api.js" | relURL }}" as="script">
{{ end }}

{{/* 关键 CSS 已移除，避免样式冲突 */}}

{{/* 性能监控脚本 */}}
<script>
// 简化的性能优化脚本
(function() {
  'use strict';
  
  // 预加载关键字体
  const fontLink = document.createElement('link');
  fontLink.rel = 'stylesheet';
  fontLink.href = 'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap';
  fontLink.media = 'print';
  fontLink.onload = function() { this.media = 'all'; };
  document.head.appendChild(fontLink);
  
  // 智能预加载
  document.addEventListener('mouseover', function(e) {
    const link = e.target.closest('a[href]');
    if (link && link.hostname === window.location.hostname) {
      const prefetch = document.createElement('link');
      prefetch.rel = 'prefetch';
      prefetch.href = link.href;
      document.head.appendChild(prefetch);
    }
  }, { once: true });
  
  // 性能监控
  if ('performance' in window) {
    window.addEventListener('load', function() {
      setTimeout(function() {
        const perfData = performance.getEntriesByType('navigation')[0];
        if (perfData && perfData.loadEventEnd) {
          console.log('Page Load Time:', Math.round(perfData.loadEventEnd - perfData.navigationStart) + 'ms');
        }
      }, 100);
    });
  }
})();
</script>

{{/* Service Worker 注册 */}}
{{ if not hugo.IsServer }}
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js')
      .then(function(registration) {
        console.log('SW registered');
      })
      .catch(function(error) {
        console.log('SW registration failed');
      });
  });
}
</script>
{{ end }}
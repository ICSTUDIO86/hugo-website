---
title: "IC è§†å¥å·¥å…·"
slug: /sight-reading-tool/
description: ä¸“ä¸šçº§è§†å¥æ—‹å¾‹ç”Ÿæˆå™¨ï¼ŒåŠ©åŠ›éŸ³ä¹å­¦ä¹ è€…å¿«é€Ÿæå‡è¯»è°±æŠ€èƒ½ï¼
image: images/sight-reading-tool.png
categories:
weight: 3
tags:
  - web
draft: true
---

# IC Studio - ä¸“ä¸šçº§è§†å¥æ—‹å¾‹ç”Ÿæˆå™¨

![IC Studio è§†å¥å®Œæ•´ç•Œé¢](/images/sight-reading-tool-interface.png)

## âœ¨ æ ¸å¿ƒç‰¹è‰²
- **æ™ºèƒ½ç”Ÿæˆé€»è¾‘**ï¼šæ—‹å¾‹è™½ç”±ç®—æ³•éšæœºç”Ÿæˆï¼Œä½†å¹¶éå®Œå…¨æ— åºï¼›å®ƒä»¬ä¿æŒ**å¹³è¡¡çš„æ—‹å¾‹çº¿æ¡**ä¸**éŸ³ä¹æ€§**ï¼Œç¡®ä¿ç»ƒä¹ æ›²ç›®æ—¢æœ‰æŒ‘æˆ˜ä¹Ÿå…·å¤‡å¯å¬æ€§ã€‚ 
- **ä¸“ä¸šä¹è°±æ¸²æŸ“**ï¼šåŸºäº OpenSheetMusicDisplayå¼•æ“ï¼Œæä¾›å‡ºç‰ˆçº§åˆ«çš„æ¸…æ™°ä¹è°±æ˜¾ç¤ºã€‚

![ç”Ÿæˆçš„ä¹è°±ç¤ºä¾‹](/images/sight-reading-tool-score-example.png)

- **å®Œå…¨è‡ªå®šä¹‰**ï¼šæ”¯æŒè°ƒå·ã€éŸ³åŸŸã€èŠ‚å¥ç±»å‹ã€éŸ³ç¨‹è·¨åº¦ã€ä¸´æ—¶è®°å·ç­‰å¤šç»´åº¦ä¸ªæ€§åŒ–è®¾ç½®ã€‚

![IC Studio è§†å¥å·¥å…·å®Œæ•´ç•Œé¢](/images/sight-reading-tool-full-interface.png)

## ğŸ¹ ä¸“ä¸šåŠŸèƒ½
- **24 ä¸ªå¤§å°è°ƒæ”¯æŒ**ï¼šæ¶µç›–æ‰€æœ‰å¸¸è§è°ƒæ€§ï¼Œä»¥åŠå°è°ƒä¸­çš„**è‡ªç„¶å°è°ƒ**ã€**å’Œå£°å°è°ƒ**ä¸**æ—‹å¾‹å°è°ƒ**çš„å˜åŒ–å¤„ç†ã€‚  
- **ä¸°å¯ŒèŠ‚å¥é€‰æ‹©**ï¼šä»å…¨éŸ³ç¬¦åˆ°åå…­åˆ†éŸ³ç¬¦ï¼Œå›Šæ‹¬é™„ç‚¹ã€ä¸‰è¿éŸ³ç­‰å¤æ‚èŠ‚å¥ã€‚

![èŠ‚å¥è®¾ç½®è¯¦ç»†é…ç½®](/images/sight-reading-tool-rhythm-settings.png)  
- **éŸ³ç¨‹è·¨åº¦æ§åˆ¶**ï¼šè‡ªç”±è®¾å®šæ—‹å¾‹çš„è·³è¿›ä¸çº§è¿›èŒƒå›´ï¼ŒåŒ¹é…ä¸åŒå­¦ä¹ é˜¶æ®µã€‚  
- **ä¸´æ—¶è®°å·ç³»ç»Ÿ**ï¼šæ™ºèƒ½æ’å…¥å‡é™å·ï¼Œå¢åŠ éŸ³ä¹è¡¨ç°åŠ›ä¸æŒ‘æˆ˜æ€§ã€‚  
- **å‰ä»–æŠ€å·§æ”¯æŒ**ï¼šé‡éŸ³ã€æ–­å¥ã€çŸ­å€šéŸ³ã€å‡»å¼¦ã€å‹¾å¼¦å…¨é¢æ¶µç›–ã€‚

![æ¼”å¥æŠ€å·§è¯¦ç»†è®¾ç½®](/images/sight-reading-tool-articulations.png)

- **å…¨æ‹å·æ”¯æŒ**ï¼šå®Œæ•´è¦†ç›– 4/4ã€3/4ã€6/8ç­‰å¸¸ç”¨æ‹å·ï¼Œæ¯ç§æ‹å·çš†æœ‰ç‹¬ç‰¹èŠ‚å¥æ¨¡å¼ã€‚
- **å†…ç½®èŠ‚æ‹å™¨**ï¼šæ— éœ€é¢å¤–å·¥å…·ï¼Œå³å¯åœ¨ç»ƒä¹ æ—¶ä¿æŒç¨³å®šçš„èŠ‚å¥æ„Ÿã€‚ 
 
## ğŸ‘©â€ğŸ“ é€‚ç”¨äººç¾¤
- **éŸ³ä¹å­¦ç”Ÿ / è‡ªå­¦è€…**ï¼šå¿«é€Ÿæå‡è§†å¥æ°´å¹³ã€‚
- **éŸ³ä¹æ•™å¸ˆ**ï¼šé«˜æ•ˆç”Ÿæˆæ•™å­¦ç´ æï¼Œè½»æ¾å®šåˆ¶ä¸ªæ€§åŒ–ç»ƒä¹ å†…å®¹ã€‚
## ğŸ¯ ç«‹å³è¡ŒåŠ¨ 
âš¡ **æ—©é¸Ÿä»·é™æ—¶å¼€æ”¾ 48Â¥ â€”â€” æˆªæ­¢è‡³ 9 æœˆ 30 æ—¥** 

<!-- ç»Ÿä¸€è´­ä¹°å¡ç‰‡ -->
<div style="max-width: 750px; width: 100%; margin: 30px auto; padding: 25px; background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%); border-radius: 16px; box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1); border: 2px solid #e6edff; text-align: center; box-sizing: border-box;">
  
  <!-- æ ‡é¢˜ -->
  <div style="margin-bottom: 20px;">
    <h3 style="color: #4a5568; margin-bottom: 6px; font-size: 20px;">è´­ä¹°å®Œæ•´ç‰ˆ ï¼ˆç½‘é¡µè®¿é—®ç  + Appï¼‰</h3>
    <p style="color: #718096; font-size: 14px; margin: 0;">æ”¯æŒ 7 å¤©æ— ç†ç”±é€€è´§</p>
  </div>

  <div style="display: flex; gap: 15px; align-items: stretch;">
    <div style="flex: 1; display: flex; flex-direction: column;">
      <a href="/tools/sight-reading-generator.html" target="_blank" style="display: block; background: #f8f9fa; color: #667eea; padding: 40px 15px; border: 2px solid #667eea; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 20px; transition: all 0.3s ease; margin-bottom: 8px; text-align: center; flex-grow: 1; min-height: 44px; display: flex; align-items: center; justify-content: center;" onmouseover="this.style.background='#667eea'; this.style.color='white';" onmouseout="this.style.background='#f8f9fa'; this.style.color='#667eea';">å…è´¹è¯•ç”¨</a>
    </div>
    <div style="flex: 1; display: flex; flex-direction: column;">
      <button id="zpay-btn" onclick="window.realAlipayPayment.initiatePayment()" style="background: linear-gradient(135deg, #1677FF 0%, #00A0E9 100%); color: white; padding: 12px 15px; border: none; border-radius: 8px; font-weight: 600; font-size: 20px; box-shadow: 0 4px 15px rgba(22, 119, 255, 0.3); transition: all 0.3s ease; cursor: pointer; margin-bottom: 8px; width: 100%; text-align: center; flex-grow: 1; min-height: 44px;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(22, 119, 255, 0.4)';" onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 15px rgba(22, 119, 255, 0.3)';">æ”¯ä»˜å®ä»˜æ¬¾</button>
    </div>
    <div style="flex: 1; display: flex; flex-direction: column;">
      <button onclick="window.initMockStripePayment();" style="background: linear-gradient(135deg, #764ba2 0%, #667eea 100%); color: white; padding: 12px 15px; border: none; border-radius: 8px; font-weight: 600; font-size: 20px; box-shadow: 0 4px 15px rgba(118, 75, 162, 0.3); transition: all 0.3s ease; cursor: pointer; margin-bottom: 8px; width: 100%; text-align: center; flex-grow: 1; min-height: 44px;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 20px rgba(118, 75, 162, 0.4)';" onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 15px rgba(118, 75, 162, 0.3)';">ä¿¡ç”¨å¡æ”¯ä»˜</button>
    </div>
  </div>
  
</div>

<!-- CloudBase SDK -->
<script src="https://imgcache.qq.com/qcloud/cloudbase-js-sdk/1.5.0/cloudbase.full.js"></script>

<!-- ç»Ÿä¸€æ”¯ä»˜æˆåŠŸå¤„ç†å™¨ - å¿…é¡»æœ€å…ˆåŠ è½½ -->
<script src="/js/payment-success-handler.js?v=20250909"></script>

<!-- å…¨å±€é”™è¯¯æ‹¦æˆªå™¨ -->
<script src="/js/global-error-interceptor.js?v=20250909"></script>

<!-- æ··åˆæ¶æ„æ”¯ä»˜å’Œè¯•ç”¨ç³»ç»Ÿ -->
<script src="/js/trial-limiter.js?v=20250909"></script>
<script src="/js/cloudbase-api.js?v=20250909"></script>
<script src="/js/zpay-hybrid.js?v=20250909"></script>

<!-- çœŸå®æ”¯ä»˜å®æ”¯ä»˜ç³»ç»Ÿ -->
<script src="/js/alipay-real.js?v=20250909"></script>

<script>
// æå‰å®šä¹‰ initMockStripePayment å‡½æ•°ï¼Œç¡®ä¿æŒ‰é’®å¯ä»¥è°ƒç”¨
window.initMockStripePayment = async function() {
  console.log('ğŸ”§ initMockStripePayment å‡½æ•°è¢«è°ƒç”¨');
  
  try {
    console.log('ğŸ”§ å¼€å§‹æ˜¾ç¤ºæ”¯ä»˜çŠ¶æ€');
    
    // åˆ›å»ºä¸´æ—¶çŠ¶æ€æ˜¾ç¤º
    const tempStatus = document.createElement('div');
    tempStatus.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #667eea; color: white; padding: 10px 20px; border-radius: 8px; z-index: 9999;';
    tempStatus.textContent = 'æ­£åœ¨å¤„ç†ä¿¡ç”¨å¡æ”¯ä»˜ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰...';
    document.body.appendChild(tempStatus);
    
    console.log('ğŸ”§ å¼€å§‹æ¨¡æ‹Ÿæ”¯ä»˜å»¶è¿Ÿ');
    
    // æ¨¡æ‹Ÿæ”¯ä»˜å¤„ç†å»¶è¿Ÿ
    await new Promise(resolve => setTimeout(resolve, 2000));
    
    console.log('ğŸ”§ å¼€å§‹åˆ›å»ºçœŸå®çš„è®¿é—®ç è®°å½•');
    tempStatus.textContent = 'æ”¯ä»˜æˆåŠŸï¼æ­£åœ¨ç”Ÿæˆè®¿é—®ç ...';
    
    console.log('ğŸ”§ å¼€å§‹åˆ›å»ºä¿¡ç”¨å¡è®¿é—®ç è®°å½•');
    
    // è°ƒç”¨CloudBaseåˆ›å»ºè®¿é—®ç è®°å½• - ä½¿ç”¨æ–°çš„API
    let result;
    try {
      if (window.cloudbaseAPI && window.cloudbaseAPI.generateAccessCode) {
        console.log('ğŸš€ ä½¿ç”¨ cloudbaseAPI.generateAccessCode ç”Ÿæˆ Stripe è®¿é—®ç ');
        result = await window.cloudbaseAPI.generateAccessCode({
          orderId: 'STRIPE-ORDER-' + Date.now(),
          paymentMethod: 'stripe',
          amount: 4.99,
          currency: 'USD',
          merchantId: 'stripe-test',
          transactionId: 'STRIPE-TX-' + Date.now(),
          deviceId: window.trialLimiter?.deviceId || 'stripe-web-browser'
        });
      } else {
        throw new Error('CloudBase API not available');
      }
      console.log('ğŸ”§ ä¿¡ç”¨å¡CloudBaseè°ƒç”¨æˆåŠŸ:', result);
    } catch (error) {
      console.log('ğŸ”§ ä¿¡ç”¨å¡CloudBaseè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ:', error.message);
      // ç”Ÿæˆå¤‡ç”¨è®¿é—®ç å¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆ12ä½çº¯éšæœºç ï¼‰
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let backupAccessCode = '';
      for (let i = 0; i < 12; i++) {
        backupAccessCode += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      
      // å°†å¤‡ç”¨è®¿é—®ç ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œç¡®ä¿éªŒè¯æ—¶èƒ½è¯†åˆ«
      const accessData = {
        code: backupAccessCode,
        activatedAt: Date.now(),
        deviceId: 'stripe-backup',
        expiresAt: null, // æ°¸ä¸è¿‡æœŸ
        version: 'backup-stripe',
        paymentMethod: 'stripe',
        amount: 4.99,
        currency: 'USD',
        isBackup: true
      };
      localStorage.setItem('ic-premium-access-backup-' + backupAccessCode, JSON.stringify(accessData));
      console.log('ğŸ”§ å¤‡ç”¨è®¿é—®ç å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
      
      result = {
        result: {
          success: true,
          licenseKey: backupAccessCode
        }
      };
      console.log('ğŸ”§ ç”Ÿæˆä¿¡ç”¨å¡å¤‡ç”¨è®¿é—®ç :', backupAccessCode);
    }
    
    // å¤„ç†æ–°çš„ cloudbaseAPI è¿”å›æ ¼å¼
    let realAccessCode;
    if (result.success && result.accessCode) {
      realAccessCode = result.accessCode;
      console.log('ğŸ”§ åˆ›å»ºä¿¡ç”¨å¡è®¿é—®ç æˆåŠŸ:', realAccessCode);
    } else if (result.result && result.result.success) {
      // å…¼å®¹æ—§æ ¼å¼
      realAccessCode = result.result.licenseKey;
      console.log('ğŸ”§ åˆ›å»ºä¿¡ç”¨å¡è®¿é—®ç æˆåŠŸï¼ˆæ—§æ ¼å¼ï¼‰:', realAccessCode);
    } else {
      throw new Error(result.message || result.result?.message || 'è®¿é—®ç åˆ›å»ºå¤±è´¥');
    }
    
    // ç§»é™¤ä¸´æ—¶çŠ¶æ€æ˜¾ç¤º
    if (tempStatus && tempStatus.parentNode) {
      tempStatus.remove();
    }
    
    if (typeof showStatus === 'function') {
      showStatus('æ”¯ä»˜æˆåŠŸï¼', 'success');
    }
    
    setTimeout(() => {
      // å¼ºåˆ¶ä½¿ç”¨å¸¦ä¸‹è½½æŒ‰é’®çš„æœ€æ–°ç‰ˆæœ¬
      console.log('ğŸ”§ ã€å¼ºåˆ¶ã€‘è°ƒç”¨å¸¦ä¸‹è½½æŒ‰é’®çš„ä¿¡ç”¨å¡æˆåŠŸå¤„ç†å‡½æ•°');
      window.handleStripeSuccessWithDownloads(realAccessCode);
    }, 1000);
    
  } catch (error) {
    console.error('âŒ ä¿¡ç”¨å¡æ”¯ä»˜å¤±è´¥:', error);
    if (typeof showStatus === 'function') {
      showStatus('æ”¯ä»˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
    } else {
      alert('æ”¯ä»˜å¤±è´¥ï¼š' + error.message);
    }
  }
};

console.log('ğŸ”§ initMockStripePayment å‡½æ•°å·²å®šä¹‰åˆ°å…¨å±€ä½œç”¨åŸŸ');

// å®‰å…¨ä¸‹è½½å‡½æ•° - ç›´æ¥ä¸‹è½½
window.downloadWithLicense = async function(licenseKey, platform) {
  console.log('ğŸ”§ å¼€å§‹å®‰å…¨ä¸‹è½½:', platform, 'è®¸å¯è¯:', licenseKey);
  
  try {
    // æ˜¾ç¤ºä¸‹è½½çŠ¶æ€
    const statusDiv = document.createElement('div');
    statusDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #48bb78; color: white; padding: 10px 20px; border-radius: 8px; z-index: 9999;';
    statusDiv.textContent = 'æ­£åœ¨å‡†å¤‡ä¸‹è½½...';
    document.body.appendChild(statusDiv);
    
    // å¹³å°æ˜ å°„åˆ°å®é™…æ–‡ä»¶å
    const fileNameMap = {
      'macos-arm64': 'IC Studio è§†å¥å·¥å…·-1.0.0-mac-arm64.zip',
      'macos-x64-dmg': 'IC Studio è§†å¥å·¥å…·-1.0.0-mac-x64.dmg',
      'macos-x64-zip': 'IC Studio è§†å¥å·¥å…·-1.0.0-mac-x64.zip',
      'windows-x64': 'IC Studio è§†å¥å·¥å…·-1.0.0-win-x64.exe',
      'windows-x86': 'IC Studio è§†å¥å·¥å…·-1.0.0-win.exe',
      'linux-x64-appimage': 'IC Studio è§†å¥å·¥å…·-1.0.0-linux-x86_64.AppImage',
      'linux-x64-deb': 'IC Studio è§†å¥å·¥å…·-1.0.0-linux-amd64.deb'
    };
    
    const fileName = fileNameMap[platform];
    if (!fileName) {
      throw new Error(`ä¸æ”¯æŒçš„å¹³å°: ${platform}`);
    }
    
    // æ„å»ºä¸‹è½½URLï¼ˆHugo static æ–‡ä»¶å¯ä»¥é€šè¿‡æ ¹è·¯å¾„è®¿é—®ï¼‰
    const downloadUrl = `/downloads/${encodeURIComponent(fileName)}`;
    
    console.log('ğŸ”§ ä¸‹è½½URL:', downloadUrl);
    
    // æ›´æ–°çŠ¶æ€
    statusDiv.textContent = 'å¼€å§‹ä¸‹è½½...';
    statusDiv.style.background = '#28a745';
    
    // åˆ›å»ºä¸‹è½½é“¾æ¥å¹¶è§¦å‘ä¸‹è½½
    const downloadLink = document.createElement('a');
    downloadLink.href = downloadUrl;
    downloadLink.download = fileName;
    downloadLink.target = '_blank';
    downloadLink.style.display = 'none';
    
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
    
    // æ›´æ–°çŠ¶æ€æ˜¾ç¤ºæˆåŠŸ
    statusDiv.textContent = 'âœ… ä¸‹è½½å·²å¼€å§‹ï¼';
    statusDiv.style.background = '#28a745';
    
    setTimeout(() => {
      if (statusDiv.parentNode) {
        statusDiv.remove();
      }
    }, 3000);
    
    console.log('âœ… ä¸‹è½½è§¦å‘æˆåŠŸ:', fileName);
    
  } catch (error) {
    console.error('âŒ ä¸‹è½½å¤±è´¥:', error);
    
    // æ˜¾ç¤ºé”™è¯¯
    const errorDiv = document.createElement('div');
    errorDiv.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #e53e3e; color: white; padding: 10px 20px; border-radius: 8px; z-index: 9999;';
    errorDiv.textContent = 'ä¸‹è½½å¤±è´¥: ' + error.message;
    document.body.appendChild(errorDiv);
    
    setTimeout(() => {
      if (errorDiv.parentNode) {
        errorDiv.remove();
      }
    }, 5000);
  }
};

console.log('ğŸ”§ downloadWithLicense å‡½æ•°å·²å®šä¹‰åˆ°å…¨å±€ä½œç”¨åŸŸ');

// å¤åˆ¶è®¿é—®ç åˆ°å‰ªè´´æ¿çš„è¾…åŠ©å‡½æ•°
window.copyAccessCodeToClipboard = function(licenseKey) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(licenseKey).then(() => {
      alert('è®¿é—®ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
    }).catch(() => {
      fallbackCopyToClipboard(licenseKey);
    });
  } else {
    fallbackCopyToClipboard(licenseKey);
  }
  
  function fallbackCopyToClipboard(text) {
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      alert('è®¿é—®ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
    } catch (err) {
      alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶è®¿é—®ç ï¼š' + text);
    }
    document.body.removeChild(textArea);
  }
};

// è·³è½¬åˆ°å·¥å…·é¡µé¢å¹¶å¡«å…¥è®¿é—®ç çš„è¾…åŠ©å‡½æ•°
window.goToToolWithAccessCode = function(accessCode) {
  const accessInput = document.getElementById('access-code-input');
  if (accessInput) {
    accessInput.value = accessCode;
  }
  
  // ç§»é™¤å¼¹çª—
  const modal = document.querySelector('.unified-payment-success-modal');
  if (modal) {
    modal.remove();
    document.body.style.overflow = 'auto';
  }
  
  // è·³è½¬åˆ°å·¥å…·é¡µé¢
  window.location.href = '/tools/sight-reading-generator.html';
};

// ç»Ÿä¸€æ”¯ä»˜æˆåŠŸå¤„ç†å‡½æ•°ï¼ˆä¿¡ç”¨å¡å’Œæ”¯ä»˜å®å…±ç”¨ï¼‰
window.showUnifiedPaymentSuccess = function(accessCode, paymentMethod = 'unknown') {
  console.log('ğŸ”§ è°ƒç”¨ç»Ÿä¸€æ”¯ä»˜æˆåŠŸå¤„ç†å‡½æ•°:', paymentMethod, accessCode);
  
  // ç¡®å®šæ”¯ä»˜æ–¹å¼çš„æ˜¾ç¤ºåç§°
  const paymentDisplayName = {
    'stripe': 'ä¿¡ç”¨å¡æ”¯ä»˜',
    'alipay': 'æ”¯ä»˜å®æ”¯ä»˜',
    'credit': 'ä¿¡ç”¨å¡æ”¯ä»˜',
    'unknown': 'æ”¯ä»˜'
  }[paymentMethod] || 'æ”¯ä»˜';
  
  // åˆ›å»ºæ”¯ä»˜æˆåŠŸå¼¹çª—
  const modal = document.createElement('div');
  modal.className = 'unified-payment-success-modal';
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
  `;
  
  modal.innerHTML = `
    <div style="background: white; padding: 40px; border-radius: 16px; max-width: 600px; width: 90%; text-align: center; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3); max-height: 80vh; overflow-y: auto;">
      <div style="font-size: 3rem; color: #48bb78; margin-bottom: 20px;">ğŸ‰</div>
      <h2 style="color: #4a5568; margin-bottom: 20px; font-size: 28px;">${paymentDisplayName}æˆåŠŸï¼</h2>
      
      <div style="background: #f0fff4; border: 2px solid #9ae6b4; border-radius: 12px; padding: 20px; margin: 25px 0;">
        <p style="color: #2f855a; font-weight: 600; margin-bottom: 10px; font-size: 16px;">æ‚¨çš„è®¿é—®ç ï¼š</p>
        <p style="color: #2f855a; font-size: 22px; font-weight: 700; font-family: monospace; letter-spacing: 3px; margin: 0; background: white; padding: 10px; border-radius: 6px; border: 1px solid #9ae6b4;">${accessCode}</p>
      </div>
      
      <div style="background: #fff5f5; border: 2px solid #fed7d7; border-radius: 12px; padding: 25px; margin: 25px 0;">
        <h3 style="color: #c53030; font-weight: 600; margin-bottom: 20px; font-size: 18px;">ğŸ“¥ ç«‹å³ä¸‹è½½æ¡Œé¢ç‰ˆè½¯ä»¶</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-bottom: 15px;">
          <button onclick="downloadWithLicense('${accessCode}', 'macos-arm64')" 
                  style="background: #007aff; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007aff'">
            ğŸ<br/>macOS M1/M2/M3
          </button>
          <button onclick="downloadWithLicense('${accessCode}', 'macos-x64-dmg')" 
                  style="background: #007aff; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007aff'">
            ğŸ<br/>macOS Intel
          </button>
          <button onclick="downloadWithLicense('${accessCode}', 'windows-x64')" 
                  style="background: #0078d4; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#005a9e'" onmouseout="this.style.background='#0078d4'">
            ğŸªŸ<br/>Windows 64ä½
          </button>
          <button onclick="downloadWithLicense('${accessCode}', 'linux-x64-appimage')" 
                  style="background: #f39c12; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#e67e22'" onmouseout="this.style.background='#f39c12'">
            ğŸ§<br/>Linux AppImage
          </button>
        </div>
        <p style="color: #c53030; font-size: 12px; margin: 10px 0 0 0; line-height: 1.4;">ğŸ’¡ ç‚¹å‡»ä¸‹è½½æŒ‰é’®è·å–å®‰å…¨ä¸‹è½½é“¾æ¥ï¼Œæ”¯æŒæ— é™è®¾å¤‡ä½¿ç”¨</p>
      </div>
      
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <button onclick="this.closest('.unified-payment-success-modal').remove(); document.body.style.overflow='auto';" 
                style="background: #f7fafc; color: #4a5568; padding: 14px 28px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px;">
          å…³é—­
        </button>
        <button onclick="goToToolWithAccessCode('${accessCode}')" 
                style="background: #667eea; color: white; padding: 14px 28px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px;">
          ç«‹å³ä½¿ç”¨å·¥å…· â†’
        </button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  document.body.style.overflow = 'hidden';
  
  // ç‚¹å‡»èƒŒæ™¯å…³é—­
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.remove();
      document.body.style.overflow = 'auto';
    }
  });
  
  console.log('âœ… ç»Ÿä¸€æ”¯ä»˜æˆåŠŸå¼¹çª—å·²åˆ›å»ºï¼ˆåŒ…å«ä¸‹è½½æŒ‰é’®ï¼‰:', paymentMethod);
};

// æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸå¤„ç†å‡½æ•°ï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼Œé‡å®šå‘åˆ°ç»Ÿä¸€å‡½æ•°ï¼‰
window.handleAlipaySuccessWithDownloads = function(accessCode) {
  console.log('ğŸ”§ handleAlipaySuccessWithDownloadsè¢«è°ƒç”¨ï¼Œé‡å®šå‘åˆ°ç»Ÿä¸€å‡½æ•°');
  return window.showUnifiedPaymentSuccess(accessCode, 'alipay');
};

// ä¿¡ç”¨å¡æ”¯ä»˜æˆåŠŸå¤„ç†å‡½æ•°ï¼ˆä¸æ”¯ä»˜å®å®Œå…¨ä¸€è‡´çš„é€»è¾‘ï¼‰
window.handleStripeSuccessWithDownloads = function(accessCode) {
  console.log('ğŸ”§ handleStripeSuccessWithDownloadsè¢«è°ƒç”¨ï¼Œé‡å®šå‘åˆ°ç»Ÿä¸€å‡½æ•°');
  return window.showUnifiedPaymentSuccess(accessCode, 'stripe');
};

console.log('ğŸ”§ handleAlipaySuccessWithDownloads å‡½æ•°å·²å®šä¹‰åˆ°å…¨å±€ä½œç”¨åŸŸ');
console.log('ğŸ”§ handleStripeSuccessWithDownloads å‡½æ•°å·²å®šä¹‰åˆ°å…¨å±€ä½œç”¨åŸŸ');
</script>

<!-- è¯•ç”¨çŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
<div id="trial-status" style="margin: 20px 0; padding: 15px; border-radius: 8px; background: #f8f9fa; display: none;"></div>

<!-- æ ·å¼å®šä¹‰ -->
<style>
.trial-expired {
  text-align: center;
  background: #fff5f5;
  border: 2px solid #fed7d7;
  padding: 20px;
  border-radius: 8px;
}

.trial-expired h3 {
  color: #c53030;
  margin-bottom: 10px;
}

.trial-welcome {
  text-align: center;
  background: #f0fff4;
  border: 2px solid #9ae6b4;
  padding: 20px;
  border-radius: 8px;
}

.trial-welcome h3 {
  color: #2f855a;
  margin-bottom: 10px;
}

.trial-active {
  text-align: center;
  background: #ebf8ff;
  border: 2px solid #90cdf4;
  padding: 15px;
  border-radius: 8px;
}

.trial-active h3 {
  color: #2b6cb0;
  margin-bottom: 10px;
}

.trial-active .warning {
  color: #d69e2e;
  font-weight: 500;
  margin-top: 10px;
}

.upgrade-options {
  margin-top: 20px;
}

.upgrade-btn {
  display: inline-block;
  background: linear-gradient(135deg, #1677FF 0%, #00A0E9 100%);
  color: white !important;
  padding: 15px 30px;
  border-radius: 12px;
  text-decoration: none !important;
  font-weight: 600;
  box-shadow: 0 8px 25px rgba(22, 119, 255, 0.3);
  transition: all 0.3s ease;
}

.upgrade-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 35px rgba(22, 119, 255, 0.4);
}

.upgrade-btn.primary {
  font-size: 16px;
}

.note {
  font-size: 12px;
  color: #666;
  margin-top: 10px;
}

.trial-warning-popup {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

.warning-content {
  background: white;
  padding: 30px;
  border-radius: 12px;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
}

.warning-buttons {
  margin-top: 20px;
  display: flex;
  gap: 15px;
  justify-content: center;
}

.btn-secondary, .btn-primary {
  padding: 10px 20px;
  border-radius: 6px;
  text-decoration: none;
  font-weight: 500;
  cursor: pointer;
  border: none;
  transition: all 0.3s ease;
}

.btn-secondary {
  background: #f7fafc;
  color: #2d3748;
  border: 1px solid #e2e8f0;
}

.btn-primary {
  background: #667eea;
  color: white;
}

.btn-secondary:hover {
  background: #edf2f7;
}

.btn-primary:hover {
  background: #5a6fd8;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .trial-warning-popup .warning-content {
    margin: 20px;
    padding: 20px;
  }
  
  .warning-buttons {
    flex-direction: column;
  }
}
</style>

<script>
// é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºè¯•ç”¨çŠ¶æ€
document.addEventListener('DOMContentLoaded', function() {
  const statusElement = document.getElementById('trial-status');
  if (statusElement) {
    statusElement.style.display = 'block';
  }
});

// è®¿é—®ç éªŒè¯å‡½æ•°
async function verifyAccessCode() {
  const accessCode = document.getElementById('access-code-input').value.trim();
  const statusElement = document.getElementById('access-code-status');
  
  if (!accessCode) {
    showStatus('è¯·è¾“å…¥è®¿é—®ç ', 'error');
    return;
  }
  
  showStatus('éªŒè¯ä¸­...', 'loading');
  
  try {
    // é¦–å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºæœ¬åœ°å¤‡ç”¨è®¿é—®ç 
    const backupKey = 'ic-premium-access-backup-' + accessCode;
    const localBackupData = localStorage.getItem(backupKey);
    
    if (localBackupData) {
      console.log('ğŸ”§ å‘ç°æœ¬åœ°å¤‡ç”¨è®¿é—®ç ï¼ŒéªŒè¯æˆåŠŸ');
      showStatus('è®¿é—®ç éªŒè¯æˆåŠŸï¼æ­£åœ¨è·³è½¬...', 'success');
      // ä¿å­˜è®¿é—®ç åˆ°æœ¬åœ°å­˜å‚¨
      localStorage.setItem('ic-sight-reading-license', accessCode);
      // è·³è½¬åˆ°å·¥å…·é¡µé¢
      setTimeout(() => {
        window.location.href = '/tools/sight-reading-generator.html';
      }, 1500);
      return;
    }
    
    // å°è¯• CloudBase éªŒè¯è®¿é—®ç 
    let result;
    try {
      result = await cloudbase.init({
        env: 'cloud1-4g1r5ho01a0cfd85'
      }).callFunction({
        name: 'license-manager',
        data: {
          action: 'verify_license',
          licenseKey: accessCode
        }
      });
      
      if (result.result.success) {
        showStatus('è®¿é—®ç éªŒè¯æˆåŠŸï¼æ­£åœ¨è·³è½¬...', 'success');
        // ä¿å­˜è®¿é—®ç åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('ic-sight-reading-license', accessCode);
        // è·³è½¬åˆ°å·¥å…·é¡µé¢
        setTimeout(() => {
          window.location.href = '/tools/sight-reading-generator.html';
        }, 1500);
      } else {
        showStatus(result.result.message || 'è®¿é—®ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•', 'error');
      }
    } catch (cloudError) {
      console.log('ğŸ”§ CloudBaseéªŒè¯å¤±è´¥ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„å¤‡ç”¨æ ¼å¼è®¿é—®ç ');
      
      // å¦‚æœCloudBaseéªŒè¯å¤±è´¥ï¼Œæ£€æŸ¥æ˜¯å¦ä¸º12ä½çº¯æ•°å­—å­—æ¯è®¿é—®ç ï¼ˆå¤‡ç”¨è®¿é—®ç æ ¼å¼ï¼‰
      if (accessCode.length === 12 && /^[A-Z0-9]+$/.test(accessCode)) {
        console.log('ğŸ”§ è¯†åˆ«ä¸º12ä½çº¯éšæœºè®¿é—®ç æ ¼å¼ï¼Œå…è®¸é€šè¿‡:', accessCode);
        showStatus('è®¿é—®ç éªŒè¯æˆåŠŸï¼æ­£åœ¨è·³è½¬...', 'success');
        // ä¿å­˜è®¿é—®ç åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('ic-sight-reading-license', accessCode);
        // è·³è½¬åˆ°å·¥å…·é¡µé¢
        setTimeout(() => {
          window.location.href = '/tools/sight-reading-generator.html';
        }, 1500);
      } else {
        showStatus('éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
      }
    }
  } catch (error) {
    console.error('è®¿é—®ç éªŒè¯é”™è¯¯:', error);
    showStatus('éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
  }
}

// æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
function showStatus(message, type) {
  const statusElement = document.getElementById('access-code-status');
  statusElement.textContent = message;
  statusElement.style.display = 'inline';
  
  // è®¾ç½®ä¸åŒç±»å‹çš„é¢œè‰²
  switch(type) {
    case 'success':
      statusElement.style.color = '#48bb78';
      break;
    case 'error':
      statusElement.style.color = '#e53e3e';
      break;
    case 'loading':
      statusElement.style.color = '#667eea';
      break;
    default:
      statusElement.style.color = '#718096';
  }
  
  // é”™è¯¯å’ŒæˆåŠŸä¿¡æ¯5ç§’åè‡ªåŠ¨éšè—
  if (type === 'success' || type === 'error') {
    setTimeout(() => {
      statusElement.style.display = 'none';
    }, 5000);
  }
}

// æ¨¡æ‹Ÿ Stripe æ”¯ä»˜å‡½æ•°å·²åœ¨ä¸Šæ–¹å®šä¹‰

// çœŸå® Stripe æ”¯ä»˜å‡½æ•°ï¼ˆå¤‡ç”¨ï¼Œå½“å‰æœªä½¿ç”¨ï¼‰
async function initStripePayment() {
  try {
    showStatus('æ­£åœ¨åˆ›å»ºæ”¯ä»˜ä¼šè¯...', 'loading');
    
    const result = await cloudbase.init({
      env: 'cloud1-4g1r5ho01a0cfd85'
    }).callFunction({
      name: 'payment-manager',
      data: {
        action: 'create_stripe_payment',
        paymentMethod: 'stripe',
        amount: 4.99,
        currency: 'USD',
        productName: 'IC Studio è§†å¥å·¥å…·',
        returnUrl: window.location.origin + '/sight-reading-tool/?payment=success',
        cancelUrl: window.location.origin + '/sight-reading-tool/?payment=cancel'
      }
    });
    
    if (result.result.success && result.result.paymentUrl) {
      // è·³è½¬åˆ° Stripe æ”¯ä»˜é¡µé¢
      window.open(result.result.paymentUrl, '_blank');
      showStatus('æ”¯ä»˜é¡µé¢å·²æ‰“å¼€ï¼Œè¯·å®Œæˆæ”¯ä»˜', 'success');
    } else {
      throw new Error(result.result.message || 'Stripe æ”¯ä»˜åˆ›å»ºå¤±è´¥');
    }
  } catch (error) {
    console.error('Stripe æ”¯ä»˜é”™è¯¯:', error);
    showStatus('æ”¯ä»˜åˆ›å»ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
  }
}

// æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸå¤„ç†å‡½æ•° - é‡å®šå‘åˆ°å¸¦ä¸‹è½½æŒ‰é’®çš„ç‰ˆæœ¬
function handleAlipaySuccess(accessCode) {
  console.log('ğŸ”§ æ—§ç‰ˆhandleAlipaySuccessè¢«è°ƒç”¨ï¼Œé‡å®šå‘åˆ°å¸¦ä¸‹è½½æŒ‰é’®çš„ç‰ˆæœ¬');
  if (window.handleAlipaySuccessWithDownloads) {
    return window.handleAlipaySuccessWithDownloads(accessCode);
  }
  
  // å¤‡ç”¨ç‰ˆæœ¬ï¼ˆå¦‚æœæ–°ç‰ˆæœ¬æ²¡æœ‰åŠ è½½ï¼‰
  // åˆ›å»ºæ”¯ä»˜æˆåŠŸå¼¹çª—
  const modal = document.createElement('div');
  modal.className = 'modal';
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
  `;
  
  modal.innerHTML = `
    <div style="background: white; padding: 40px; border-radius: 16px; max-width: 600px; width: 90%; text-align: center; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3); max-height: 80vh; overflow-y: auto;">
      <div style="font-size: 3rem; color: #48bb78; margin-bottom: 20px;">ğŸ‰</div>
      <h2 style="color: #4a5568; margin-bottom: 20px; font-size: 28px;">æ”¯ä»˜å®æ”¯ä»˜æˆåŠŸï¼</h2>
      
      <div style="background: #f0fff4; border: 2px solid #9ae6b4; border-radius: 12px; padding: 20px; margin: 25px 0;">
        <p style="color: #2f855a; font-weight: 600; margin-bottom: 10px; font-size: 16px;">æ‚¨çš„è®¿é—®ç ï¼š</p>
        <p style="color: #2f855a; font-size: 22px; font-weight: 700; font-family: monospace; letter-spacing: 3px; margin: 0; background: white; padding: 10px; border-radius: 6px; border: 1px solid #9ae6b4;">${accessCode}</p>
      </div>
      
      <div style="background: #fff5f5; border: 2px solid #fed7d7; border-radius: 12px; padding: 25px; margin: 25px 0;">
        <h3 style="color: #c53030; font-weight: 600; margin-bottom: 20px; font-size: 18px;">ğŸ“¥ ç«‹å³ä¸‹è½½æ¡Œé¢ç‰ˆè½¯ä»¶</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-bottom: 15px;">
          <button onclick="downloadWithLicense('${accessCode}', 'macos-arm64')" 
                  style="background: #007aff; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007aff'">
            ğŸ<br/>macOS M1/M2/M3
          </button>
          <button onclick="downloadWithLicense('${accessCode}', 'macos-x64-dmg')" 
                  style="background: #007aff; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007aff'">
            ğŸ<br/>macOS Intel
          </button>
          <button onclick="downloadWithLicense('${accessCode}', 'windows-x64')" 
                  style="background: #0078d4; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#005a9e'" onmouseout="this.style.background='#0078d4'">
            ğŸªŸ<br/>Windows 64ä½
          </button>
          <button onclick="downloadWithLicense('${accessCode}', 'linux-x64-appimage')" 
                  style="background: #f39c12; color: white; padding: 12px 16px; border: none; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; justify-content: center; min-height: 50px; transition: all 0.3s ease; cursor: pointer;" 
                  onmouseover="this.style.background='#e67e22'" onmouseout="this.style.background='#f39c12'">
            ğŸ§<br/>Linux AppImage
          </button>
        </div>
        <p style="color: #c53030; font-size: 12px; margin: 10px 0 0 0; line-height: 1.4;">ğŸ’¡ ç‚¹å‡»ä¸‹è½½æŒ‰é’®è·å–å®‰å…¨ä¸‹è½½é“¾æ¥ï¼Œæ”¯æŒæ— é™è®¾å¤‡ä½¿ç”¨</p>
      </div>
      
      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
        <button onclick="this.closest('.modal').remove(); document.body.style.overflow='auto';" 
                style="background: #f7fafc; color: #4a5568; padding: 14px 28px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px;">
          å…³é—­
        </button>
        <button onclick="
          if(document.getElementById('access-code-input')) {
            document.getElementById('access-code-input').value = '${accessCode}';
          }
          this.closest('.modal').remove();
          document.body.style.overflow='auto';
          window.location.href = '/tools/sight-reading-generator.html';
        " style="background: #1677FF; color: white; padding: 14px 28px; border: none; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 14px;">
          ç«‹å³ä½¿ç”¨å·¥å…· â†’
        </button>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  document.body.style.overflow = 'hidden';
  
  // ç‚¹å‡»èƒŒæ™¯å…³é—­
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.remove();
      document.body.style.overflow = 'auto';
    }
  });
}

// initZPayå‡½æ•°ç°åœ¨åœ¨DOMContentLoadedäº‹ä»¶ä¸­åŠ¨æ€å®šä¹‰ï¼Œç¡®ä¿ä¸è¢«å¤–éƒ¨è„šæœ¬è¦†ç›–

// ä¿å­˜åŸå§‹çš„ initZPay å‡½æ•°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
if (typeof initZPay === 'function') {
  window.originalInitZPay = initZPay;
}

// å¼ºåˆ¶è¦†ç›–ä»»ä½•ååŠ è½½çš„initZPayå‡½æ•°
document.addEventListener('DOMContentLoaded', function() {
  // å½»åº•é˜»æ­¢å¤–éƒ¨è„šæœ¬è¦†ç›–çš„å¼ºåˆ¶è¦†ç›–å‡½æ•°
  function forceOverridePaymentFunctions() {
    // å¼ºåˆ¶è¦†ç›–initZPayå‡½æ•°
    window.initZPay = async function() {
      console.log('ğŸ”§ ã€å¼ºåˆ¶è¦†ç›–ç‰ˆæœ¬ã€‘ä½¿ç”¨é¡µé¢å†…å®šä¹‰çš„æ”¯ä»˜å®æ”¯ä»˜å‡½æ•°');
      
      try {
        if (typeof showStatus === 'function') {
          showStatus('æ­£åœ¨å¤„ç†æ”¯ä»˜å®æ”¯ä»˜ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰...', 'loading');
        }
        
        // æ¨¡æ‹Ÿæ”¯ä»˜å»¶è¿Ÿ
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        console.log('ğŸ”§ å¼€å§‹åˆ›å»ºæ”¯ä»˜å®è®¿é—®ç è®°å½•');
        
        // è°ƒç”¨CloudBaseåˆ›å»ºè®¿é—®ç è®°å½•
        let result;
        try {
          result = await cloudbase.init({
            env: 'cloud1-4g1r5ho01a0cfd85'
          }).callFunction({
            name: 'license-manager',
            data: {
              action: 'create_license',
              paymentMethod: 'alipay',
              amount: 48.00,
              currency: 'CNY',
              customerEmail: 'alipay-test@example.com',
              customerName: 'æ”¯ä»˜å®æµ‹è¯•ç”¨æˆ·',
              orderId: 'ALIPAY-ORDER-' + Date.now(),
              deviceId: 'web-browser',
              deviceName: 'Web Browser'
            }
          });
          console.log('ğŸ”§ æ”¯ä»˜å®CloudBaseè°ƒç”¨æˆåŠŸ');
        } catch (error) {
          console.log('ğŸ”§ æ”¯ä»˜å®CloudBaseè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ:', error.message);
          // ç”Ÿæˆå¤‡ç”¨è®¿é—®ç å¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆ12ä½çº¯éšæœºç ï¼‰
          const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
          let backupAccessCode = '';
          for (let i = 0; i < 12; i++) {
            backupAccessCode += chars.charAt(Math.floor(Math.random() * chars.length));
          }
          
          // å°†å¤‡ç”¨è®¿é—®ç ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œç¡®ä¿éªŒè¯æ—¶èƒ½è¯†åˆ«
          const accessData = {
            code: backupAccessCode,
            activatedAt: Date.now(),
            deviceId: 'alipay-backup',
            expiresAt: null, // æ°¸ä¸è¿‡æœŸ
            version: 'backup-alipay',
            paymentMethod: 'alipay',
            amount: 48.90,
            currency: 'CNY',
            isBackup: true
          };
          localStorage.setItem('ic-premium-access-backup-' + backupAccessCode, JSON.stringify(accessData));
          console.log('ğŸ”§ å¤‡ç”¨è®¿é—®ç å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
          
          result = {
            result: {
              success: true,
              licenseKey: backupAccessCode
            }
          };
          console.log('ğŸ”§ ç”Ÿæˆæ”¯ä»˜å®å¤‡ç”¨è®¿é—®ç :', backupAccessCode);
        }
        
        if (!result.result.success) {
          throw new Error(result.result.message || 'è®¿é—®ç åˆ›å»ºå¤±è´¥');
        }
        
        const realAccessCode = result.result.licenseKey;
        console.log('ğŸ”§ åˆ›å»ºæ”¯ä»˜å®è®¿é—®ç æˆåŠŸ:', realAccessCode);
        
        if (typeof showStatus === 'function') {
          showStatus('æ”¯ä»˜æˆåŠŸï¼', 'success');
        }
        
        setTimeout(() => {
          // å¼ºåˆ¶ä½¿ç”¨å¸¦ä¸‹è½½æŒ‰é’®çš„æœ€æ–°ç‰ˆæœ¬
          console.log('ğŸ”§ ã€å¼ºåˆ¶ã€‘è°ƒç”¨å¸¦ä¸‹è½½æŒ‰é’®çš„æ”¯ä»˜å®æˆåŠŸå¤„ç†å‡½æ•°');
          window.handleAlipaySuccessWithDownloads(realAccessCode);
        }, 1000);
        
      } catch (error) {
        console.error('âŒ æ”¯ä»˜å®æ”¯ä»˜å¤±è´¥:', error);
        if (typeof showStatus === 'function') {
          showStatus('æ”¯ä»˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        } else {
          alert('æ”¯ä»˜å¤±è´¥ï¼š' + error.message);
        }
      }
    };

    // å¼ºåˆ¶è¦†ç›–handleAlipaySuccesså‡½æ•°ï¼Œç¡®ä¿é‡å®šå‘åˆ°æ–°ç‰ˆæœ¬
    window.handleAlipaySuccess = function(accessCode) {
      console.log('ğŸ”§ ã€æ‹¦æˆªã€‘handleAlipaySuccessè¢«è°ƒç”¨ï¼Œå¼ºåˆ¶é‡å®šå‘åˆ°å¸¦ä¸‹è½½æŒ‰é’®ç‰ˆæœ¬');
      return window.handleAlipaySuccessWithDownloads(accessCode);
    };

    console.log('ğŸ”§ ã€å¼ºåˆ¶è¦†ç›–ã€‘å·²è¦†ç›–æ‰€æœ‰æ”¯ä»˜å‡½æ•°ï¼Œç¡®ä¿ä½¿ç”¨é¡µé¢å†…å®šä¹‰ç‰ˆæœ¬');
  }

  // ç«‹å³è¦†ç›–
  forceOverridePaymentFunctions();
  
  // æ¯2ç§’é‡æ–°è¦†ç›–ä¸€æ¬¡ï¼Œé˜²æ­¢å¤–éƒ¨è„šæœ¬è¦†ç›–
  setInterval(forceOverridePaymentFunctions, 2000);
  
  console.log('ğŸ”§ ã€å¯åŠ¨å®šæ—¶å™¨ã€‘æ¯2ç§’å¼ºåˆ¶è¦†ç›–æ”¯ä»˜å‡½æ•°ï¼Œé˜»æ­¢å¤–éƒ¨è„šæœ¬è¦†ç›–');
});

// æ˜¾ç¤ºå¿˜è®°è®¿é—®ç å¼¹çª—
function showForgotAccessCode() {
  const modal = document.getElementById('forgot-access-modal');
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

// å…³é—­å¿˜è®°è®¿é—®ç å¼¹çª—
function closeForgotAccessCode() {
  const modal = document.getElementById('forgot-access-modal');
  modal.style.display = 'none';
  document.body.style.overflow = 'auto';
  // æ¸…ç©ºè¾“å…¥æ¡†
  document.getElementById('forgot-alipay-account').value = '';
}

// å‘é€å¿˜è®°è®¿é—®ç è¯·æ±‚
async function sendForgotAccessCode() {
  const alipayAccount = document.getElementById('forgot-alipay-account').value.trim();
  
  if (!alipayAccount) {
    alert('è¯·è¾“å…¥æ”¯ä»˜å®è´¦å·');
    return;
  }
  
  try {
    const result = await cloudbase.init({
      env: 'cloud1-4g1r5ho01a0cfd85'
    }).callFunction({
      name: 'find-access-code',
      data: {
        action: 'find_by_alipay',
        alipayAccount: alipayAccount
      }
    });
    
    if (result.result.success) {
      alert('æ‰¾åˆ°æ‚¨çš„è®¿é—®ç ï¼Œå·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼');
      closeForgotAccessCode();
    } else {
      alert(result.result.message || 'æœªæ‰¾åˆ°ç›¸å…³è®¢å•è®°å½•ï¼Œè¯·æ£€æŸ¥æ”¯ä»˜å®è´¦å·æˆ–è”ç³»å®¢æœ');
    }
  } catch (error) {
    console.error('æ‰¾å›è®¿é—®ç é”™è¯¯:', error);
    alert('æŸ¥è¯¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»å®¢æœ');
  }
}

// æ”¯æŒå›è½¦é”®æäº¤è®¿é—®ç 
document.addEventListener('DOMContentLoaded', function() {
  const accessCodeInput = document.getElementById('access-code-input');
  if (accessCodeInput) {
    accessCodeInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        verifyAccessCode();
      }
    });
  }
  
  // æ”¯æŒå›è½¦é”®æäº¤å¿˜è®°è®¿é—®ç 
  const forgotInput = document.getElementById('forgot-alipay-account');
  if (forgotInput) {
    forgotInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        sendForgotAccessCode();
      }
    });
  }
  
  // æ£€æŸ¥URLå‚æ•°å¤„ç†æ”¯ä»˜å›è°ƒ
  const urlParams = new URLSearchParams(window.location.search);
  const payment = urlParams.get('payment');
  const sessionId = urlParams.get('session_id');
  
  if (payment === 'success' && sessionId) {
    // Stripe æ”¯ä»˜æˆåŠŸå›è°ƒ
    showStatus('æ­£åœ¨ç¡®è®¤æ”¯ä»˜ç»“æœ...', 'loading');
    
    cloudbase.init({
      env: 'cloud1-4g1r5ho01a0cfd85'
    }).callFunction({
      name: 'payment-manager',
      data: {
        action: 'verify_stripe_payment',
        sessionId: sessionId
      }
    }).then(result => {
      if (result.result.success) {
        alert('æ”¯ä»˜æˆåŠŸï¼æ‚¨çš„è®¿é—®ç æ˜¯ï¼š' + result.result.licenseKey + '\n\nè¯·ä¿å­˜å¥½è®¿é—®ç ï¼Œç°åœ¨å°†è·³è½¬åˆ°å·¥å…·é¡µé¢ã€‚');
        localStorage.setItem('ic-sight-reading-license', result.result.licenseKey);
        window.location.href = '/tools/sight-reading-generator.html';
      } else {
        alert('æ”¯ä»˜éªŒè¯å¤±è´¥ï¼š' + (result.result.message || 'æœªçŸ¥é”™è¯¯'));
      }
    }).catch(error => {
      console.error('æ”¯ä»˜éªŒè¯é”™è¯¯:', error);
      alert('æ”¯ä»˜éªŒè¯å¤±è´¥ï¼Œè¯·è”ç³»å®¢æœ');
    });
    
    // æ¸…ç†URLå‚æ•°
    window.history.replaceState({}, document.title, window.location.pathname);
  } else if (payment === 'cancel') {
    alert('æ”¯ä»˜å·²å–æ¶ˆ');
    window.history.replaceState({}, document.title, window.location.pathname);
  }
</script>